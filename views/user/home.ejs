<!DOCTYPE html>
<html lang="en">

<head>
    <title>Hien Bakery Shop</title>
    <%- include('../partials/user/head') %>
</head>

<body class="goto-here">
    <%- include('../partials/user/header') %>
        <!-- END nav -->

        <section id="home-section" class="hero">
            <div class="home-slider owl-carousel">
                <div class="slider-item" style="background-image: url(images/slideshow_1.png);">
                </div>
                <div class="slider-item" style="background-image: url(images/slideshow_2.png);">
                </div>
                <div class="slider-item" style="background-image: url(images/slideshow_4.png);">
                </div>
                <div class="slider-item" style="background-image: url(images/slideshow_5.png);">
                </div>
            </div>
        </section>

        <section class="ftco-section">
            <div class="container">
                <div class="row no-gutters ftco-services">
                    <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
                        <div class="media block-6 services mb-md-0 mb-4">
                            <div class="icon bg-color-1 active d-flex justify-content-center align-items-center mb-2">
                                <span class="flaticon-shipped"></span>
                            </div>
                            <div class="media-body">
                                <h3 class="heading">Miễn phí vận chuyển</h3>
                                <span>Cho đơn hàng trên 1tr500 VND</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
                        <div class="media block-6 services mb-md-0 mb-4">
                            <div class="icon bg-color-2 d-flex justify-content-center align-items-center mb-2">
                                <span class="flaticon-diet"></span>
                            </div>
                            <div class="media-body">
                                <h3 class="heading">Luôn tươi mới</h3>
                                <span>Sản phẩm được đóng gói cẩn thận</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
                        <div class="media block-6 services mb-md-0 mb-4">
                            <div class="icon bg-color-3 d-flex justify-content-center align-items-center mb-2">
                                <span class="flaticon-award"></span>
                            </div>
                            <div class="media-body">
                                <h3 class="heading">Chất lượng vượt trội</h3>
                                <span>Sản phẩm chất lượng</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
                        <div class="media block-6 services mb-md-0 mb-4">
                            <div class="icon bg-color-4 d-flex justify-content-center align-items-center mb-2">
                                <span class="flaticon-customer-service"></span>
                            </div>
                            <div class="media-body">
                                <h3 class="heading">Hỗ trợ</h3>
                                <span>Hỗ trợ 24/7</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="ftco-section ftco-category ftco-no-pt">
            <div class="container">
                <div class="row">
                    <!-- Banner 1 -->
                    <div class="col-md-4">
                        <div class="category-wrap-2 ftco-animate img d-flex align-items-center justify-content-center"
                            style="background-image: url(images/banner_img1.jpg); height: 400px; background-size: cover; background-position: center;">
                        </div>
                    </div>

                    <!-- Banner 2 -->
                    <div class="col-md-4">
                        <div class="category-wrap-2 ftco-animate img d-flex align-items-center justify-content-center"
                            style="background-image: url(images/banner_img2.jpg); height: 400px; background-size: cover; background-position: center;">
                        </div>
                    </div>

                    <!-- Banner 3 -->
                    <div class="col-md-4">
                        <div class="category-wrap-2 ftco-animate img d-flex align-items-center justify-content-center"
                            style="background-image: url(images/banner_img3.jpg); height: 400px; background-size: cover; background-position: center;">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="ftco-section">
            <div class="container">
                <div class="row justify-content-center mb-3 pb-3">
                    <div class="col-md-12 heading-section text-center ftco-animate">
                        <span class="subheading">Sản phẩm nổi bật</span>
                        <h2 class="mb-4">Bánh ngọt của chúng tôi</h2>
                        <p>Những chiếc bánh được làm thủ công với tình yêu và sự tận tâm</p>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <% if (products && products.length> 0) { %>
                        <% products.forEach(product=> { %>
                            <div class="col-md-6 col-lg-3 ftco-animate">
                                <div class="product">
                                    <a href="/products/<%= product._id %>" class="img-prod">
                                        <% if (product.images && product.images.length> 0) { %>
                                            <img class="img-fluid" src="/uploads/products/<%= product.images[0] %>"
                                                alt="<%= product.name %>">
                                            <% } else { %>
                                                <img class="img-fluid" src="/images/no-image.jpg" alt="No image">
                                                <% } %>

                                                    <% if (product.salePrice && product.salePrice < product.price) { %>
                                                        <% const discount=Math.round((1 - product.salePrice /
                                                            product.price) * 100) %>
                                                            <span class="status">
                                                                <%= discount %>%
                                                            </span>
                                                            <% } %>

                                                                <div class="overlay"></div>
                                    </a>
                                    <div class="text py-3 pb-4 px-3 text-center">
                                        <h3><a href="/products/<%= product._id %>">
                                                <%= product.name %>
                                            </a></h3>

                                        <div class="d-flex">
                                            <div class="pricing">
                                                <p class="price">
                                                    <% if (product.salePrice && product.salePrice < product.price) { %>
                                                        <span class="mr-2 price-dc">
                                                            <%= product.price.toLocaleString('vi-VN') %>₫
                                                        </span>
                                                        <span class="price-sale">
                                                            <%= product.salePrice.toLocaleString('vi-VN') %>₫
                                                        </span>
                                                        <% } else { %>
                                                            <span>
                                                                <%= product.price.toLocaleString('vi-VN') %>₫
                                                            </span>
                                                            <% } %>
                                                </p>
                                            </div>
                                        </div>

                                        <div class="bottom-area d-flex px-3">
                                            <div class="m-auto d-flex">
                                                <a href="/products/<%= product._id %>"
                                                    class="add-to-cart d-flex justify-content-center align-items-center text-center"
                                                    title="Xem chi tiết">
                                                    <span><i class="ion-ios-menu"></i></span>
                                                </a>
                                                <a href="javascript:void(0);" onclick="addToCart('<%= product._id %>')"
                                                    class="buy-now d-flex justify-content-center align-items-center mx-1"
                                                    title="Thêm vào giỏ">
                                                    <span><i class="ion-ios-cart"></i></span>
                                                </a>
                                                <a href="javascript:void(0);"
                                                    onclick="addToWishlist('<%= product._id %>')"
                                                    class="heart d-flex justify-content-center align-items-center"
                                                    title="Yêu thích">
                                                    <span><i class="ion-ios-heart"></i></span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <div class="col-12 text-center py-5">
                                        <p class="text-muted">Chưa có sản phẩm nào</p>
                                    </div>
                                    <% } %>
                </div>
            </div>
        </section>

        <section class="ftco-section img" style="background-image: url(images/bg_3.jpg);">
            <div class="container">
                <div class="row justify-content-end">
                    <div class="col-md-6 heading-section ftco-animate deal-of-the-day ftco-animate">
                        <span class="subheading">Best Price For You</span>
                        <h2 class="mb-4">Deal of the day</h2>
                        <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia</p>
                        <h3><a href="#">Spinach</a></h3>
                        <span class="price">$10 <a href="#">now $5 only</a></span>
                        <div id="timer" class="d-flex mt-5">
                            <div class="time" id="days"></div>
                            <div class="time pl-3" id="hours"></div>
                            <div class="time pl-3" id="minutes"></div>
                            <div class="time pl-3" id="seconds"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <hr />
        <section class="ftco-section ftco-no-pt ftco-no-pb py-5 bg-light">
            <div class="container py-4">
                <div class="row d-flex justify-content-center py-5">
                    <div class="col-md-6">
                        <h2 style="font-size: 22px;" class="mb-0">Subcribe to our Newsletter</h2>
                        <span>Get e-mail updates about our latest shops and special offers</span>
                    </div>
                    <div class="col-md-6 d-flex align-items-center">
                        <form action="#" class="subscribe-form">
                            <div class="form-group d-flex">
                                <input type="text" class="form-control" placeholder="Enter email address">
                                <input type="submit" value="Subscribe" class="submit px-3">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <%- include('../partials/user/footer') %>


            <!-- loader -->
            <%- include('../partials/user/load') %>
                <%- include('../partials/user/scripts') %>

                    <script>
                        // Thêm vào giỏ hàng
                        function addToCart(productId) {
                            fetch('/cart/add', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    productId: productId,
                                    quantity: 1
                                })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        // Cập nhật số lượng trên header
                                        document.getElementById('cart-count').textContent = data.cartCount;

                                        // Thông báo
                                        showNotification('success', data.message);
                                    } else {
                                        showNotification('error', data.message);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    showNotification('error', 'Có lỗi xảy ra!');
                                });
                        }

                        // Thêm vào yêu thích
                        function addToWishlist(productId) {
                            fetch('/wishlist/add', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ productId: productId })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        // Cập nhật số lượng trên header
                                        document.getElementById('wishlist-count').textContent = data.wishlistCount;

                                        // Thông báo
                                        showNotification('success', data.message);
                                    } else {
                                        showNotification('error', data.message);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    showNotification('error', 'Có lỗi xảy ra!');
                                });
                        }

                        // Hàm hiển thị thông báo đẹp
                        function showNotification(type, message) {
                            // Tạo element thông báo
                            const notification = document.createElement('div');
                            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} notification-popup`;
                            notification.innerHTML = `
                            <strong>${type === 'success' ? 'Thành công' : 'Thất bại'}</strong> ${message}
                        `;

                            // CSS cho notification
                            notification.style.cssText = `
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            z-index: 9999;
                            min-width: 300px;
                            padding: 15px 20px;
                            border-radius: 5px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                            animation: slideInRight 0.3s ease-out;
                        `;

                            document.body.appendChild(notification);

                            // Tự động xóa sau 3 giây
                            setTimeout(() => {
                                notification.style.animation = 'slideOutRight 0.3s ease-out';
                                setTimeout(() => notification.remove(), 300);
                            }, 3000);
                        }
                    </script>

                    <style>
                        @keyframes slideInRight {
                            from {
                                transform: translateX(100%);
                                opacity: 0;
                            }

                            to {
                                transform: translateX(0);
                                opacity: 1;
                            }
                        }

                        @keyframes slideOutRight {
                            from {
                                transform: translateX(0);
                                opacity: 1;
                            }

                            to {
                                transform: translateX(100%);
                                opacity: 0;
                            }
                        }
                    </style>

</body>

</html>