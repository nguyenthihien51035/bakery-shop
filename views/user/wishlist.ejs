<!DOCTYPE html>
<html lang="en">

<head>
	<title>Hien Bakery Shop</title>
	<%- include('../partials/user/head') %>
</head>

<body class="goto-here">
	<%- include('../partials/user/header') %>
		<!-- END nav -->

		<div class="hero-wrap hero-bread" style="background-image: url('images/wishlist.png');">
			<div class="container">
				<div class="row no-gutters slider-text align-items-center justify-content-end">
					<div class="col-md-9 ftco-animate text-right">
						<p class="breadcrumbs"><span class="mr-2 font-weight-bold"><a href="/">Trang chủ /</a></span>
							<span class="font-weight-bold">Yêu thích</span>
						</p>
						<h1 class="mb-0 bread">Sản phẩm yêu thích</h1>
					</div>
				</div>
			</div>
		</div>

		<section class="ftco-section ftco-cart">
			<div class="container">
				<div class="row">
					<div class="col-md-12 ftco-animate">
						<div class="cart-list">
							<table class="table">
								<thead class="thead-primary">
									<tr class="text-center">
										<th>&nbsp;</th>
										<th>Hình ảnh</th>
										<th>Tên sản phẩm</th>
										<th>Giá</th>
										<th>Số lượng</th>
										<th>Tổng</th>
									</tr>
								</thead>
								<tbody>
									<% if (products && products.length> 0) { %>
										<% products.forEach(product=> { %>
											<tr class="text-center">
												<td class="product-remove">
													<a href="javascript:void(0);"
														onclick="removeFromWishlist('<%= product._id %>')">
														<span class="ion-ios-close"></span>
													</a>
												</td>

												<td class="image-prod">
													<% let imageUrl='/images/no-image.jpg' ; if (product.images &&
														product.images.length> 0) {
														imageUrl = '/uploads/products/' + product.images[0];
														}
														%>
														<div class="img"
															style="background-image:url('<%= imageUrl %>');"></div>
												</td>

												<td class="product-name">
													<h3>
														<%= product.name %>
													</h3>
													<p>
														<%= product.description ? product.description.substring(0, 80)
															+ '...' : '' %>
													</p>
												</td>

												<td class="price">
													<%= product.price.toLocaleString('vi-VN') %>₫
												</td>

												<td class="quantity">
													<div class="input-group mb-3">
														<input type="number" class="quantity form-control input-number"
															value="1" min="1" max="100">
													</div>
												</td>

												<td class="total">
													<%= product.price.toLocaleString('vi-VN') %>₫
												</td>
											</tr>
											<% }) %>
												<% } else { %>
													<tr>
														<td colspan="6" class="text-center py-5">
															<img src="/images/empty-wishlist.png" alt="Empty"
																style="max-width: 200px; opacity: 0.5;">
															<h4 class="mt-3">Danh sách yêu thích trống</h4>
															<p class="text-muted">Bạn chưa có sản phẩm yêu thích nào</p>
															<a href="/" class="btn btn-primary mt-3">Tiếp tục mua
																sắm</a>
														</td>
													</tr>
													<% } %>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="ftco-section ftco-no-pt ftco-no-pb py-5 bg-light">
		</section>
		<%- include('../partials/user/load') %>
			<%- include('../partials/user/scripts') %>
				<script>
					// Xóa khỏi wishlist
					function removeFromWishlist(productId) {
						if (!confirm('Bạn có chắc muốn xóa sản phẩm này khỏi danh sách yêu thích?')) {
							return;
						}

						fetch('/wishlist/remove', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({ productId: productId })
						})
							.then(response => response.json())
							.then(data => {
								if (data.success) {
									// Cập nhật số lượng trên header
									document.getElementById('wishlist-count').textContent = data.wishlistCount;

									// Reload trang để cập nhật danh sách
									location.reload();
								} else {
									alert(data.message);
								}
							})
							.catch(error => {
								console.error('Error:', error);
								alert('Có lỗi xảy ra!');
							});
					}
				</script>

</body>

</html>