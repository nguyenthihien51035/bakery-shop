<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/"
    data-template="vertical-menu-template-free">

<head>
    <%- include('../partials/admin/head') %>
</head>

<body>
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <%- include('../partials/admin/navbar') %>

                <div class="layout-page">
                    <%- include('../partials/admin/header') %>

                        <div class="content-wrapper">
                            <div class="container-xxl flex-grow-1 container-p-y">
                                <h4 class="fw-bold py-3 mb-4">
                                    <span class="text-muted fw-light">Qu·∫£n l√Ω / S·∫£n ph·∫©m /</span> Th√™m m·ªõi
                                </h4>

                                <!-- Flash Messages -->
                                <% if (typeof success !=='undefined' && success.length> 0) { %>
                                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                                        <strong>Th√†nh c√¥ng!</strong>
                                        <%= success %>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                    </div>
                                    <% } %>
                                        <% if (typeof error !=='undefined' && error.length> 0) { %>
                                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <strong>L·ªói!</strong>
                                                <%= error %>
                                                    <button type="button" class="btn-close"
                                                        data-bs-dismiss="alert"></button>
                                            </div>
                                            <% } %>

                                                <form action="/admin/products/create" method="POST"
                                                    enctype="multipart/form-data" id="productForm">
                                                    <div class="row">
                                                        <!-- C·ªôt tr√°i - Form ch√≠nh -->
                                                        <div class="col-md-8">
                                                            <!-- Th√¥ng tin c∆° b·∫£n -->
                                                            <div class="card mb-4">
                                                                <div class="card-header">
                                                                    <h5 class="mb-0"><i
                                                                            class="bx bx-info-circle me-2"></i>Th√¥ng tin
                                                                        c∆° b·∫£n</h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="mb-3">
                                                                        <label class="form-label" for="productName">
                                                                            T√™n s·∫£n ph·∫©m <span
                                                                                class="text-danger">*</span>
                                                                        </label>
                                                                        <input type="text" class="form-control"
                                                                            id="productName" name="name"
                                                                            placeholder="VD: LILY, MATCHA STRAWBERRY CREAMY..."
                                                                            required />
                                                                    </div>

                                                                    <div class="mb-3">
                                                                        <label class="form-label" for="productDesc">
                                                                            M√¥ t·∫£ <span class="text-danger">*</span>
                                                                        </label>
                                                                        <textarea class="form-control" id="productDesc"
                                                                            name="description" rows="6"
                                                                            placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ s·∫£n ph·∫©m...&#10;&#10;VD: D√≤ng B√°nh kem l·∫°nh (Mousse), v·ªã Ph√¥ mai nh√¢n xo√†i chanh leo. K√≠ch th∆∞·ªõc: B√°nh c√≥ 1 size duy nh·∫•t 18cm cao 4cm d√†nh cho 6-8 ng∆∞·ªùi d√πng..."
                                                                            required></textarea>
                                                                        <div class="form-text">M√¥ t·∫£ chi ti·∫øt gi√∫p kh√°ch
                                                                            h√†ng hi·ªÉu r√µ h∆°n v·ªÅ s·∫£n ph·∫©m</div>
                                                                    </div>

                                                                    <div class="row">
                                                                        <div class="col-md-6 mb-3">
                                                                            <label class="form-label"
                                                                                for="productPrice">
                                                                                Gi√° b√°n <span
                                                                                    class="text-danger">*</span>
                                                                            </label>
                                                                            <div class="input-group">
                                                                                <input type="number"
                                                                                    class="form-control"
                                                                                    id="productPrice" name="price"
                                                                                    min="0" step="1000"
                                                                                    placeholder="75000" required />
                                                                                <span class="input-group-text">‚Ç´</span>
                                                                            </div>
                                                                            <div class="form-text">Nh·∫≠p gi√° kh√¥ng c√≥ d·∫•u
                                                                                ph·∫©y</div>
                                                                        </div>

                                                                        <div class="col-md-6 mb-3">
                                                                            <label class="form-label"
                                                                                for="productSize">K√≠ch th∆∞·ªõc</label>
                                                                            <input type="text" class="form-control"
                                                                                id="productSize" name="size"
                                                                                placeholder="VD: 18cm, Nh·ªè (1-2 ng∆∞·ªùi)..." />
                                                                            <div class="form-text">Size ho·∫∑c s·ªë ng∆∞·ªùi
                                                                                d√πng</div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="mb-3">
                                                                        <label class="form-label" for="productCategory">
                                                                            Danh m·ª•c <span class="text-danger">*</span>
                                                                        </label>
                                                                        <select class="form-select" id="productCategory"
                                                                            name="category" required>
                                                                            <option value="">-- Ch·ªçn danh m·ª•c --
                                                                            </option>
                                                                            <% categories.forEach(category=> { %>
                                                                                <option value="<%= category._id %>">
                                                                                    <%= category.name %>
                                                                                </option>
                                                                                <% }) %>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Upload ·∫£nh -->
                                                            <div class="card mb-4">
                                                                <div class="card-header">
                                                                    <h5 class="mb-0"><i
                                                                            class="bx bx-image me-2"></i>H√¨nh ·∫£nh s·∫£n
                                                                        ph·∫©m</h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="mb-3">
                                                                        <label class="form-label" for="productImages">
                                                                            T·∫£i l√™n nhi·ªÅu ·∫£nh <span
                                                                                class="text-danger">*</span>
                                                                        </label>
                                                                        <input class="form-control" type="file"
                                                                            id="productImages" name="images"
                                                                            accept="image/*" multiple required />
                                                                        <div class="form-text">
                                                                            Ch·ªçn nhi·ªÅu ·∫£nh (t·ªëi ƒëa 10 ·∫£nh, m·ªói ·∫£nh t·ªëi
                                                                            ƒëa 5MB)
                                                                        </div>
                                                                    </div>

                                                                    <!-- Preview ·∫£nh -->
                                                                    <div id="imagePreview" class="row g-2 mt-2"></div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- C·ªôt ph·∫£i - Tr·∫°ng th√°i & H∆∞·ªõng d·∫´n -->
                                                        <div class="col-md-4">
                                                            <!-- Tr·∫°ng th√°i -->
                                                            <div class="card mb-3">
                                                                <div class="card-header">
                                                                    <h5 class="mb-0"><i class="bx bx-cog me-2"></i>Tr·∫°ng
                                                                        th√°i</h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="form-check form-switch mb-2">
                                                                        <input class="form-check-input" type="checkbox"
                                                                            name="isActive" id="isActive" checked />
                                                                        <label class="form-check-label" for="isActive">
                                                                            <strong>Hi·ªÉn th·ªã s·∫£n ph·∫©m</strong>
                                                                        </label>
                                                                    </div>
                                                                    <div class="form-text">
                                                                        <i class="bx bx-info-circle"></i>
                                                                        B·∫≠t ƒë·ªÉ hi·ªÉn th·ªã s·∫£n ph·∫©m tr√™n website
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- H∆∞·ªõng d·∫´n -->
                                                            <div class="card bg-light">
                                                                <div class="card-body">
                                                                    <h5 class="card-title">
                                                                        <i class="bx bx-help-circle text-primary"></i>
                                                                        H∆∞·ªõng d·∫´n
                                                                    </h5>
                                                                    <hr>

                                                                    <div class="mb-3">
                                                                        <h6 class="text-primary">
                                                                            <i class="bx bx-chevron-right"></i> T√™n s·∫£n
                                                                            ph·∫©m
                                                                        </h6>
                                                                        <p class="small text-muted mb-0">
                                                                            ƒê·∫∑t t√™n ng·∫Øn g·ªçn, h·∫•p d·∫´n. VD: "LILY", "Kem
                                                                            Matcha M√≠a"
                                                                        </p>
                                                                    </div>

                                                                    <div class="mb-3">
                                                                        <h6 class="text-primary">
                                                                            <i class="bx bx-chevron-right"></i> M√¥ t·∫£
                                                                        </h6>
                                                                        <p class="small text-muted mb-0">
                                                                            M√¥ t·∫£ chi ti·∫øt: d√≤ng b√°nh, v·ªã, k√≠ch th∆∞·ªõc,
                                                                            s·ªë ng∆∞·ªùi d√πng, nguy√™n li·ªáu...
                                                                        </p>
                                                                    </div>

                                                                    <div class="mb-3">
                                                                        <h6 class="text-primary">
                                                                            <i class="bx bx-chevron-right"></i> Gi√°
                                                                        </h6>
                                                                        <p class="small text-muted mb-0">
                                                                            Nh·∫≠p gi√° b·∫±ng s·ªë, kh√¥ng d·∫•u ph·∫©y. VD: 75000,
                                                                            720000
                                                                        </p>
                                                                    </div>

                                                                    <div class="mb-0">
                                                                        <h6 class="text-primary">
                                                                            <i class="bx bx-chevron-right"></i> H√¨nh ·∫£nh
                                                                        </h6>
                                                                        <p class="small text-muted mb-0">
                                                                            Ch·ªçn ·∫£nh r√µ n√©t, ƒë·∫πp m·∫Øt. ·∫¢nh ƒë·∫ßu ti√™n s·∫Ω l√†
                                                                            ·∫£nh ch√≠nh.
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Buttons -->
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="card">
                                                                <div class="card-body">
                                                                    <button type="submit" class="btn btn-primary">
                                                                        <i class="bx bx-save me-1"></i> L∆∞u s·∫£n ph·∫©m
                                                                    </button>
                                                                    <a href="/admin/products"
                                                                        class="btn btn-outline-secondary">
                                                                        <i class="bx bx-x me-1"></i> H·ªßy
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                            </div>
                        </div>
                </div>
        </div>
    </div>

    <%- include('../partials/admin/scripts') %>

        <script>
            // Preview ·∫£nh khi ch·ªçn file
            document.getElementById('productImages').addEventListener('change', function (e) {
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = '';

                const files = Array.from(e.target.files);

                if (files.length > 10) {
                    alert('Ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 10 ·∫£nh!');
                    this.value = '';
                    return;
                }

                files.forEach((file, index) => {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File ' + file.name + ' qu√° l·ªõn (>5MB)!');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const col = document.createElement('div');
                        col.className = 'col-md-3';
                        col.innerHTML = `
                        <div class="card">
                            <img src="${e.target.result}" class="card-img-top" style="height: 150px; object-fit: cover;" />
                            <div class="card-body p-2 text-center">
                                <small class="text-muted">${index === 0 ? 'üìå ·∫¢nh ch√≠nh' : '·∫¢nh ' + (index + 1)}</small>
                            </div>
                        </div>
                    `;
                        preview.appendChild(col);
                    };
                    reader.readAsDataURL(file);
                });
            });

            // Validate form
            document.getElementById('productForm').addEventListener('submit', function (e) {
                const name = document.getElementById('productName').value.trim();
                const price = document.getElementById('productPrice').value;
                const category = document.getElementById('productCategory').value;
                const description = document.getElementById('productDesc').value.trim();
                const images = document.getElementById('productImages').files;

                if (!name || !price || !category || !description) {
                    e.preventDefault();
                    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
                    return false;
                }

                if (images.length === 0) {
                    e.preventDefault();
                    alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 ·∫£nh!');
                    return false;
                }

                if (parseFloat(price) < 0) {
                    e.preventDefault();
                    alert('Gi√° ph·∫£i l√† s·ªë d∆∞∆°ng!');
                    return false;
                }

                return true;
            });
        </script>
</body>

</html>